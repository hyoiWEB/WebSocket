{"version":3,"sources":["js/main.js"],"names":["posX","posY","posZ","scale","renderer","scene","camera","loading","initRenderer","THREE","WebGLRenderer","alpha","antialias","logarithmicDepthBuffer","gammaOutput","setClearColor","Color","setSize","window","innerWidth","innerHeight","domElement","style","position","top","left","document","body","appendChild","initScene","Scene","PerspectiveCamera","set","add","light","AmbientLight","result","loadModel","dst","vrmLoader","VRMLoader","Promise","resolve","load","vrm","rotation","Math","PI","traverse","object","material","Array","isArray","i","il","length","MeshBasicMaterial","Material","prototype","copy","call","color","map","lights","skinning","morphTargets","morphNormals","getObjectByName","clock","Clock","stats","Stats","dom","bindPage","net","posenet","video","loadVideo","setupGui","resRenderer","resScene","all","getElementById","display","canvas","ctx","getContext","flipHorizontal","width","videoWidth","height","videoHeight","animate","requestAnimationFrame","Object","keys","guiState","changeToArchitecture","dispose","imageScaleFactor","input","outputStride","pose","estimateSinglePose","poses","push","minPoseConfidence","minPartConfidence","output","showVideo","clearRect","save","drawImage","restore","vecX","Vector3","vecY","vecZ","halfPi","deg2rad","deg","rad2deg","rad","updateJoint","src","root","node","leaf","min","max","from","clone","sub","normalize","to","quat","Quaternion","axis","cross","angle","acos","dot","setFromAxisAngle","setFromQuaternion","adjJoint","x","y","z","quatX","quatY","quatZ","quaternion","multiply","forEach","score","keypoints","showPoints","drawKeypoints","showSkeleton","drawSkeleton","showBoundingBox","drawBoundingBox","joint","key","armLow2Hand","angleX","angleY","adjX","pos","divideScalar","applyAxisAngle","delta","getDelta","render","update","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia"],"mappings":"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","file":"main.fb6bbcaf.js","sourceRoot":"..","sourcesContent":["//モデルの位置\nconst posX = 0;\nconst posY = -1;\nconst posZ = -2.0;\n//モデルのサイズ\nconst scale = 1.0;\n\nlet renderer, scene, camera;\nlet loading;\n\n//THREEのレンダラの初期化\nconst initRenderer = async () => {\n\t//z-fighting対策でlogarithmicDepthBufferを指定\n\trenderer = new THREE.WebGLRenderer({ alpha: true, antialias: true, logarithmicDepthBuffer: true });\n\trenderer.gammaOutput = true;\n\trenderer.setClearColor(new THREE.Color(0xffffff), 0);\n\trenderer.setSize(window.innerWidth, window.innerHeight);\n\trenderer.domElement.style.position = \"absolute\";\n\trenderer.domElement.style.top = \"0px\";\n\trenderer.domElement.style.left = \"0px\";\n\tdocument.body.appendChild(renderer.domElement);\n}\n//THREEのシーンの初期化\nconst initScene = async () => {\n\tscene = new THREE.Scene();\n\n\tcamera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000 );\n\tcamera.position.set(0, 0, 0);\n\n\tscene.add(camera);\n\n\tlet light = new THREE.AmbientLight(0xffffff, 1.0);\n\tscene.add(light);\n\n\t//VRMモデルの読み込み\n\tlet result = await loadModel();\n\n\treturn result;\n}\n\n//モデルデータ\nlet dst = {};\n\n//VRMモデルの読み込み\nconst loadModel = async () => {\n\tlet vrmLoader = new THREE.VRMLoader();\n\tlet result = await new Promise(resolve => {\n\t\tvrmLoader.load(\"assets/VRoid.vrm\", (vrm) => {\n\t\t\tvrm.scene.position.set(posX, posY, posZ);\n\t\t\tvrm.scene.scale.set(scale, scale, scale);\n\t\t\tvrm.scene.rotation.set(0.0, Math.PI, 0.0);\n\n\t\t\t// VRMLoader doesn't support VRM Unlit extension yet so\n\t\t\t// converting all materials to MeshBasicMaterial here as workaround so far.\n\t\t\tvrm.scene.traverse((object) => {\n\t\t\t\tif(!object.material){ return; }\n\n\t\t\t\tif(Array.isArray(object.material)){\n\t\t\t\t\tfor(let i = 0, il = object.material.length; i < il; i ++){\n\t\t\t\t\t\tlet material = new THREE.MeshBasicMaterial();\n\t\t\t\t\t\tTHREE.Material.prototype.copy.call(material, object.material[i]);\n\t\t\t\t\t\tmaterial.color.copy(object.material[i].color);\n\t\t\t\t\t\tmaterial.map = object.material[i].map;\n\t\t\t\t\t\tmaterial.lights = false;\n\t\t\t\t\t\tmaterial.skinning = object.material[i].skinning;\n\t\t\t\t\t\tmaterial.morphTargets = object.material[i].morphTargets;\n\t\t\t\t\t\tmaterial.morphNormals = object.material[i].morphNormals;\n\t\t\t\t\t\tobject.material[i] = material;\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tlet material = new THREE.MeshBasicMaterial();\n\t\t\t\t\tTHREE.Material.prototype.copy.call(material, object.material);\n\t\t\t\t\tmaterial.color.copy(object.material.color);\n\t\t\t\t\tmaterial.map = object.material.map;\n\t\t\t\t\tmaterial.lights = false;\n\t\t\t\t\tmaterial.skinning = object.material.skinning;\n\t\t\t\t\tmaterial.morphTargets = object.material.morphTargets;\n\t\t\t\t\tmaterial.morphNormals = object.material.morphNormals;\n\t\t\t\t\tobject.material = material;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdst[\"hips\"]       = vrm.scene.getObjectByName(\"J_Bip_C_Hips\");\n\t\t\tdst[\"spine\"]      = vrm.scene.getObjectByName(\"J_Bip_C_Spine\");\n\t\t\tdst[\"chest\"]      = vrm.scene.getObjectByName(\"J_Bip_C_Chest\");\n\t\t\tdst[\"upperChest\"] = vrm.scene.getObjectByName(\"J_Bip_C_UpperChest\");\n\t\t\tdst[\"neck\"]       = vrm.scene.getObjectByName(\"J_Bip_C_Neck\");\n\t\t\tdst[\"head\"]       = vrm.scene.getObjectByName(\"J_Bip_C_Head\");\n\t\t\tdst[\"upperArmL\"]  = vrm.scene.getObjectByName(\"J_Bip_L_UpperArm\");\n\t\t\tdst[\"upperArmR\"]  = vrm.scene.getObjectByName(\"J_Bip_R_UpperArm\");\n\t\t\tdst[\"lowerArmL\"]  = vrm.scene.getObjectByName(\"J_Bip_L_LowerArm\");\n\t\t\tdst[\"lowerArmR\"]  = vrm.scene.getObjectByName(\"J_Bip_R_LowerArm\");\n\t\t\tdst[\"handL\"]      = vrm.scene.getObjectByName(\"J_Bip_L_Hand\");\n\t\t\tdst[\"handR\"]      = vrm.scene.getObjectByName(\"J_Bip_R_Hand\");\n\t\t\tdst[\"upperLegL\"]  = vrm.scene.getObjectByName(\"J_Bip_L_UpperLeg\");\n\t\t\tdst[\"upperLegR\"]  = vrm.scene.getObjectByName(\"J_Bip_R_UpperLeg\");\n\t\t\tdst[\"lowerLegL\"]  = vrm.scene.getObjectByName(\"J_Bip_L_LowerLeg\");\n\t\t\tdst[\"lowerLegR\"]  = vrm.scene.getObjectByName(\"J_Bip_R_LowerLeg\");\n\t\t\tdst[\"footL\"]      = vrm.scene.getObjectByName(\"J_Bip_L_Foot\");\n\t\t\tdst[\"footR\"]      = vrm.scene.getObjectByName(\"J_Bip_R_Foot\");\n/*\n\t\t\t//VRoidの0.2.11から鼻のボーンが無くなったので頭の傾きは一旦取り下げ\n\t\t\t//PoseNet側に鼻、両目、両耳のキーポイントがあるので5点アルゴリズムで姿勢は計算できる？\n\t\t\tdst[\"nose\"]       = vrm.scene.getObjectByName(\"J_Adj_C_FaceNose\");\n\t\t\tdst[\"eyeL\"]       = vrm.scene.getObjectByName(\"J_Adj_L_FaceEyeSet\");\n\t\t\tdst[\"eyeR\"]       = vrm.scene.getObjectByName(\"J_Adj_R_FaceEyeSet\");\n\n\t\t\tdst[\"eyeLen\"]     = dst[\"eyeR\"].position.x - dst[\"eyeL\"].position.x;\n\n\t\t\tdst[\"noseLen\"]    = (dst[\"eyeR\"].position.y + dst[\"eyeL\"].position.y) / 2.0 - dst[\"nose\"].position.y;\n\t\t\tdst[\"angleXBase\"] = dst[\"eyeLen\"] / dst[\"noseLen\"];\n*/\n\t\t\tscene.add(vrm.scene);\n\t\t\t//camera.lookAt(vrm.scene.position); \n\n\t\t\treturn resolve(vrm.scene);\n\t\t});\n\t});\n\n\treturn result;\n}\nlet clock = new THREE.Clock();\nlet stats = new Stats();\ndocument.body.appendChild(stats.dom);\n\nconst bindPage = async () => {\n\tconst net = await posenet.load(0.75);\n\tconst video = await loadVideo();\n\t/*\n\tlet video = document.getElementById(\"video\");\n\tvideo.width = videoWidth;\n\tvideo.height = videoHeight;\n\tvideo.src = \"test.mp4\";\n\tvideo.loop = true;\n\tvideo.play();\n\t*/\n\tsetupGui([], net);\n\n\tconst resRenderer = initRenderer();\n\tconst resScene = initScene();\n\n\t//レンダラ、シーンの初期化が済んでいるか\n\tawait Promise.all([resRenderer, resScene]);\n\n\tloading = document.getElementById(\"loading\");\n\tloading.style.display = \"none\";\n\n\tconst canvas = document.getElementById(\"output\");\n\tconst ctx = canvas.getContext(\"2d\");\n\tconst flipHorizontal = false;\n\n\tcanvas.width = videoWidth;\n\tcanvas.height = videoHeight;\n\n\tconst animate = async () => {\n\t\trequestAnimationFrame(animate);\n\n\t\tif(Object.keys(dst).length == 0){ return; }\n\n\t\tif(guiState.changeToArchitecture){\n\t\t\tguiState.net.dispose();\n\t\t\tguiState.net = await posenet.load(guiState.changeToArchitecture);\n\t\t\tguiState.changeToArchitecture = null;\n\t\t}\n\n\t\tconst imageScaleFactor = guiState.input.imageScaleFactor;\n\t\tconst outputStride = guiState.input.outputStride;\n\n\t\tconst pose = await guiState.net.estimateSinglePose(video, imageScaleFactor, flipHorizontal, outputStride);\n\n\t\tlet poses = [];\n\t\tposes.push(pose);\n\n\t\tlet minPoseConfidence = guiState.minPoseConfidence;\n\t\tlet minPartConfidence = guiState.minPartConfidence;\n\n\t\tif(guiState.output.showVideo){\n\t\t\tctx.clearRect(0, 0, videoWidth, videoHeight);\n\t\t\tctx.save();\n\t\t\tctx.drawImage(video, 0, 0, videoWidth, videoHeight);\n\t\t\tctx.restore();\n\t\t}\n\n\t\tconst vecX = new THREE.Vector3(1, 0, 0);\n\t\tconst vecY = new THREE.Vector3(0, 1, 0);\n\t\tconst vecZ = new THREE.Vector3(0, 0, 1);\n\t\tconst halfPi = Math.PI / 2;\n\n\t\tconst deg2rad = (deg) => { return deg * Math.PI / 180.0; }\n\t\tconst rad2deg = (rad) => { return rad * 180.0 / Math.PI; }\n\n\t\t//srcのrootからnodeとnodeからleafの角度でdstを回転\n\t\tconst updateJoint = (src, root, node, leaf, dst, min = -360, max = 360) => {\n\t\t\tlet from = src[leaf].clone().sub(src[node]).normalize();\n\t\t\tlet to = src[node].clone().sub(src[root]).normalize();\n\t\t\tlet quat = new THREE.Quaternion();\n\t\t\tlet axis = from.clone().cross(to).normalize();\n\t\t\tlet angle = Math.acos(from.dot(to));\n\t\t\tangle = Math.max(deg2rad(min), Math.min(deg2rad(max), angle));\n\t\t\tquat.setFromAxisAngle(axis, angle);\n\t\t\tdst.rotation.setFromQuaternion(quat);\n\t\t}\n\n\t\t//回転角度の調整\n\t\tconst adjJoint = (x, y, z, dst) => {\n\t\t\tlet quatX = new THREE.Quaternion();\n\t\t\tquatX.setFromAxisAngle(vecX, deg2rad(x));\n\t\t\tlet quatY = new THREE.Quaternion();\n\t\t\tquatY.setFromAxisAngle(vecY, deg2rad(y));\n\t\t\tlet quatZ = new THREE.Quaternion();\n\t\t\tquatZ.setFromAxisAngle(vecZ, -deg2rad(z));\n\n\t\t\tlet quat = dst.quaternion.multiply(quatZ).multiply(quatY).multiply(quatX);\n\t\t\tdst.rotation.setFromQuaternion(quat);\n\t\t}\n\n\t\tposes.forEach(({score, keypoints}) => {\n\t\t\tif(score < minPoseConfidence){ return; }\n\n\t\t\tif(guiState.output.showPoints){ drawKeypoints(keypoints, minPartConfidence, ctx); }\n\t\t\tif(guiState.output.showSkeleton){ drawSkeleton(keypoints, minPartConfidence, ctx); }\n\t\t\tif(guiState.output.showBoundingBox){ drawBoundingBox(keypoints, ctx); }\n\n\t\t\tlet src = {};\n\t\t\tsrc[\"nose\"]      = keypoints[0];\n\t\t\tsrc[\"eyeL\"]      = keypoints[1]; src[\"eyeR\"]       = keypoints[2];\n\t\t\tsrc[\"earL\"]      = keypoints[3]; src[\"earR\"]       = keypoints[4];\n\t\t\tsrc[\"upperArmL\"] = keypoints[5]; src[\"upperArmR\"]  = keypoints[6];\n\t\t\tsrc[\"lowerArmL\"] = keypoints[7]; src[\"lowerArmR\"]  = keypoints[8];\n\t\t\tsrc[\"handL\"]     = keypoints[9]; src[\"handR\"]      = keypoints[10];\n\t\t\tsrc[\"upperLegL\"] = keypoints[11]; src[\"upperLegR\"] = keypoints[12];\n\t\t\tsrc[\"lowerLegL\"] = keypoints[13]; src[\"lowerLegR\"] = keypoints[14];\n\t\t\tsrc[\"footL\"]     = keypoints[15]; src[\"footR\"]     = keypoints[16];\n\n\t\t\tlet joint = {};\n\t\t\tObject.keys(src).forEach((key) => { \n\t\t\t\tif(src[key].score > minPartConfidence){\n\t\t\t\t\t//PoseNetの機能強化あるいは他の姿勢推定ライブラリに切り替えられるようVector3で作っておく\n\t\t\t\t\tjoint[key]  = new THREE.Vector3(src[key].position.x, videoHeight - src[key].position.y, 0);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t//左腕\n\t\t\tif(joint[\"upperArmL\"]){\n\t\t\t\tif(joint[\"lowerArmL\"]){\n\t\t\t\t\tif(joint[\"upperArmR\"]){ \n\t\t\t\t\t\tupdateJoint(joint, \"upperArmR\", \"upperArmL\", \"lowerArmL\", dst[\"upperArmL\"]); \n\t\t\t\t\t\t//adjJoint(0, -30, 0, dst[\"upperArmL\"]); //ダミー\n\t\t\t\t\t}\n\t\t\t\t\tif(joint[\"handL\"]){ \n\t\t\t\t\t\tupdateJoint(joint, \"upperArmL\", \"lowerArmL\", \"handL\", dst[\"lowerArmL\"]); \n\n\t\t\t\t\t\t//常に手のひらを向けるよう補正\n\t\t\t\t\t\tlet armLow2Hand = joint[\"handL\"].clone().sub(joint[\"lowerArmL\"]).normalize();\n\t\t\t\t\t\tlet angleX = rad2deg(armLow2Hand.y) + 90;\n\t\t\t\t\t\tlet angleY = Math.min(0, rad2deg(armLow2Hand.x));\n\t\t\t\t\t\tadjJoint(angleX, angleY, 0, dst[\"lowerArmL\"]);\n\n\t\t\t\t\t\tdst[\"handL\"].rotation.setFromQuaternion(new THREE.Quaternion());\n\t\t\t\t\t\t//adjJoint(0, 0, -20, dst[\"handL\"]); //ダミー\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t//右腕\n\t\t\tif(joint[\"upperArmR\"]){\n\t\t\t\tif(joint[\"lowerArmR\"]){\n\t\t\t\t\tif(joint[\"upperArmL\"]){ \n\t\t\t\t\t\tupdateJoint(joint, \"upperArmL\", \"upperArmR\", \"lowerArmR\", dst[\"upperArmR\"]); \n\t\t\t\t\t\t//adjJoint(0, 30, 0, dst[\"upperArmR\"]); //ダミー\n\t\t\t\t\t}\n\t\t\t\t\tif(joint[\"handR\"]){ \n\t\t\t\t\t\tupdateJoint(joint, \"upperArmR\", \"lowerArmR\", \"handR\", dst[\"lowerArmR\"]); \n\n\t\t\t\t\t\t//常に手のひらを向けるよう補正\n\t\t\t\t\t\tlet armLow2Hand = joint[\"handR\"].clone().sub(joint[\"lowerArmR\"]).normalize();\n\t\t\t\t\t\tlet angleX = rad2deg(armLow2Hand.y) + 90;\n\t\t\t\t\t\tlet angleY = Math.max(0, rad2deg(armLow2Hand.x));\n\t\t\t\t\t\tadjJoint(angleX, angleY, 0, dst[\"lowerArmR\"]);\n\n\t\t\t\t\t\tdst[\"handR\"].rotation.setFromQuaternion(new THREE.Quaternion());\n\t\t\t\t\t\t//adjJoint(0, 0, 20, dst[\"handR\"]); //ダミー\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t//胸\n\t\t\tif(joint[\"upperArmL\"] && joint[\"upperArmR\"]){\n\t\t\t\tjoint[\"upperArmLL\"] = joint[\"upperArmL\"].clone().add(vecX);\n\t\t\t\tupdateJoint(joint, \"upperArmLL\", \"upperArmL\", \"upperArmR\", dst[\"upperChest\"], -20, 20);\n\t\t\t}\n\t\t\t//頭\n/*\n\t\t\tif(joint[\"eyeL\"] && joint[\"eyeR\"]){\n\t\t\t\tif(joint[\"nose\"]){\n\t\t\t\t\tlet quatX = new THREE.Quaternion();\n\t\t\t\t\tlet quatY = new THREE.Quaternion();\n\t\t\t\t\tlet quatZ = new THREE.Quaternion();\n\t\t\t\t\tconst adjX = 0.1, minX = deg2rad(-45), maxX = deg2rad(45);\n\t\t\t\t\tconst adjY = 0.2, minY = deg2rad(-45), maxY = deg2rad(45);\n\t\t\t\t\tconst adjZ = 0.1, minZ = deg2rad(-45), maxZ = deg2rad(45);\n\n\t\t\t\t\t//////////////////////////////////////////////////////////\n\t\t\t\t\t//両目の中央から鼻までの高さと、モデルの同部分の比率が首のX軸の角度\n\t\t\t\t\t//距離が長ければ下向き、短ければ上向き\n\t\t\t\t\t//鼻が目より上に来るほど上向いた場合、まず姿勢推定が失敗するので考えない\n\t\t\t\t\tlet eyeL2R = joint[\"eyeR\"].clone().sub(joint[\"eyeL\"]).normalize();\n\t\t\t\t\tlet eyeL2Nose = joint[\"nose\"].clone().sub(joint[\"eyeL\"]);\n\n\t\t\t\t\t//左目から右目のベクトルに、左目から鼻のベクトルを射影\n\t\t\t\t\t//なので、実際には「両目の中央」ではないので注意\n\t\t\t\t\tlet relEyeL2NosePrjEyeL2R = eyeL2Nose.projectOnVector(eyeL2R);\n\t\t\t\t\tlet absEyeL2NosePrjEyeL2R = relEyeL2NosePrjEyeL2R.clone().add(joint[\"eyeL\"]);\n\n\t\t\t\t\tlet eyeLen = joint[\"eyeR\"].clone().sub(joint[\"eyeL\"]).length();\n\t\t\t\t\tlet noseLen = absEyeL2NosePrjEyeL2R.clone().sub(joint[\"nose\"]).length();\n\n\t\t\t\t\tlet axisX = new THREE.Vector3(-1, 0, 0);\n\t\t\t\t\tlet angleX = ((eyeLen / noseLen) / (dst[\"angleXBase\"])) * adjX;\n\t\t\t\t\tangleX = Math.max(minX, Math.min(maxX, angleX));\n\t\t\t\t\tquatX.setFromAxisAngle(axisX, angleX);\n\n\t\t\t\t\t//////////////////////////////////////////////////////////\n\t\t\t\t\t//両目の軸上での鼻の位置が首のY軸の角度\n\t\t\t\t\t//中央と比較したいので2で割る\n\t\t\t\t\tlet halfEyeLen = eyeLen / 2;\n\t\t\t\t\tlet projLen = relEyeL2NosePrjEyeL2R.length();\n\t\t\t\t\tlet axisY = new THREE.Vector3(0, -1, 0);\n\n\t\t\t\t\t//右向きが正、左向きが負になるよう1を引く\n\t\t\t\t\tlet angleY = ((projLen / halfEyeLen) - 1) * adjY;\n\t\t\t\t\tangleY = Math.max(minY, Math.min(maxY, angleY));\n\t\t\t\t\tquatY.setFromAxisAngle(axisY, angleY);\n\n\t\t\t\t\t//////////////////////////////////////////////////////////\n\t\t\t\t\t//両肩の角度と両目の角度の差分が首のZ軸の角度\n\t\t\t\t\tif(joint[\"upperArmL\"] && joint[\"upperArmR\"]){\n\t\t\t\t\t\tlet armL2R = joint[\"upperArmR\"].clone().sub(joint[\"upperArmL\"]).normalize();\n\t\t\t\t\t\tlet axisZ = eyeL2R.clone().cross(armL2R).normalize();\n\t\t\t\t\t\tlet angleZ = Math.acos(eyeL2R.dot(armL2R)) * adjZ;\n\t\t\t\t\t\tangleZ = Math.max(minZ, Math.min(maxZ, angleZ));\n\t\t\t\t\t\tquatZ.setFromAxisAngle(axisZ, angleZ)\n\t\t\t\t\t}\n\n\t\t\t\t\t//////////////////////////////////////////////////////////\n\t\t\t\t\t//X軸はneckではなくheadの位置で曲がる\n\t\t\t\t\tlet quat = quatY.multiply(quatZ);\n\t\t\t\t\tdst[\"neck\"].rotation.setFromQuaternion(quat);\n\t\t\t\t\tdst[\"head\"].rotation.setFromQuaternion(quatX);\n\t\t\t\t}\n\t\t\t}\n*/\n\t\t\t//腰\n\t\t\tif(joint[\"upperLegL\"] && joint[\"upperLegR\"]){\n\t\t\t\t//基準点が無いので左肩の左水平方向に仮のジョイントを作る\n\t\t\t\tjoint[\"upperLegLL\"] = joint[\"upperLegL\"].clone().add(vecX);\n\t\t\t\tupdateJoint(joint, \"upperLegLL\", \"upperLegL\", \"upperLegR\", dst[\"spine\"], -10, 10);\n\n\t\t\t\tconst adjX = 2.0;\n\n\t\t\t\tlet pos = joint[\"upperLegL\"].clone().add(joint[\"upperLegR\"]).divideScalar(2);\n\t\t\t\tlet x = -(pos.x - (videoWidth / 2)) / videoWidth;\n\t\t\t\tdst[\"hips\"].position.x = x * adjX;\n\n\t\t\t\t//adjJoint(-20, 0, 0, dst[\"spine\"]); //ダミー\n\t\t\t}\n\t\t\t//左脚\n\t\t\tif(joint[\"upperLegL\"]){\n\t\t\t\tif(joint[\"lowerLegL\"]){\n\t\t\t\t\tif(joint[\"upperLegR\"]){\n\t\t\t\t\t\t//基準点が無いので左脚付け根の上方向に仮のジョイントを作る\n\t\t\t\t\t\tjoint[\"upperLegLUp\"] = joint[\"upperLegR\"].clone().sub(joint[\"upperLegL\"]).normalize();\n\t\t\t\t\t\tjoint[\"upperLegLUp\"].applyAxisAngle(vecZ, -halfPi).add(joint[\"upperLegL\"]);\n\t\t\t\t\t\tupdateJoint(joint, \"upperLegLUp\", \"upperLegL\", \"lowerLegL\", dst[\"upperLegL\"], -20, 20); \n\t\t\t\t\t}\n\t\t\t\t\tif(joint[\"footL\"]){ \n\t\t\t\t\t\tupdateJoint(joint, \"upperLegL\", \"lowerLegL\", \"footL\", dst[\"lowerLegL\"], -20, 20); \n\n\t\t\t\t\t\t//基準点が無いので左足首の下垂直方向に仮のジョイントを作る\n\t\t\t\t\t\tjoint[\"footLDown\"] = joint[\"footL\"].clone().sub(vecY);\n\t\t\t\t\t\tupdateJoint(joint, \"lowerLegL\", \"footL\", \"footLDown\", dst[\"footL\"]); \n\t\t\t\t\t}else{\n\t\t\t\t\t\t//基準点が無いので左膝の下垂直方向に仮のジョイントを作る\n\t\t\t\t\t\tjoint[\"lowerLegLDown\"] = joint[\"lowerLegL\"].clone().sub(vecY);\n\t\t\t\t\t\tupdateJoint(joint, \"upperLegL\", \"lowerLegL\", \"lowerLegLDown\", dst[\"lowerLegL\"]); \n\t\t\t\t\t\tupdateJoint(joint, \"lowerLegL\", \"lowerLegLDown\", \"lowerLegLDown\", dst[\"footL\"]); \n\t\t\t\t\t}\n\t\t\t\t\t//adjJoint(0, 10, 0, dst[\"footL\"]); //ダミー\n\t\t\t\t}\n\t\t\t}\n\t\t\t//右脚\n\t\t\tif(joint[\"upperLegR\"]){\n\t\t\t\tif(joint[\"lowerLegR\"]){\n\t\t\t\t\tif(joint[\"upperLegL\"]){\n\t\t\t\t\t\t//基準点が無いので右脚付け根の上方向に仮のジョイントを作る\n\t\t\t\t\t\tjoint[\"upperLegRUp\"] = joint[\"upperLegL\"].clone().sub(joint[\"upperLegR\"]).normalize();\n\t\t\t\t\t\tjoint[\"upperLegRUp\"].applyAxisAngle(vecZ, halfPi).add(joint[\"upperLegR\"]);\n\t\t\t\t\t\tupdateJoint(joint, \"upperLegRUp\", \"upperLegR\", \"lowerLegR\", dst[\"upperLegR\"], -20, 20); \n\t\t\t\t\t}\n\t\t\t\t\tif(joint[\"footR\"]){ \n\t\t\t\t\t\tupdateJoint(joint, \"upperLegR\", \"lowerLegR\", \"footR\", dst[\"lowerLegR\"], -20, 20); \n\n\t\t\t\t\t\t//基準点が無いので右足首の下垂直方向に仮のジョイントを作る\n\t\t\t\t\t\tjoint[\"footRDown\"] = joint[\"footR\"].clone().sub(vecY);\n\t\t\t\t\t\tupdateJoint(joint, \"lowerLegR\", \"footR\", \"footRDown\", dst[\"footR\"]); \n\t\t\t\t\t}else{\n\t\t\t\t\t\t//基準点が無いので右膝の下垂直方向に仮のジョイントを作る\n\t\t\t\t\t\tjoint[\"lowerLegRDown\"] = joint[\"lowerLegR\"].clone().sub(vecY);\n\t\t\t\t\t\tupdateJoint(joint, \"upperLegR\", \"lowerLegR\", \"lowerLegRDown\", dst[\"lowerLegR\"]); \n\t\t\t\t\t\tupdateJoint(joint, \"lowerLegR\", \"lowerLegRDown\", \"lowerLegRDown\", dst[\"footR\"]); \n\t\t\t\t\t}\n\t\t\t\t\t//adjJoint(0, -10, 0, dst[\"footR\"]); //ダミー\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\n\t\tlet delta = clock.getDelta();\n\t\trenderer.render(scene, camera);\n\t\tstats.update();\n\t}\n\n\trequestAnimationFrame(animate);\n}\n\nnavigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\nbindPage();"]}